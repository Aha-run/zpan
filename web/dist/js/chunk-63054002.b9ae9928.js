(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-63054002"],{"531c":function(e,t,s){},"55ac":function(e,t,s){"use strict";s("7a36")},6275:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var i=s("8bbf"),o=s.n(i),n=s("9225"),a=s("c0d6"),l=s("41cb");const r=e=>{const t=o.a.extend(e);return function(e={}){console.log(e);let s=new t({i18n:n["a"],store:a["a"],router:l["a"],propsData:e}).$mount(document.createElement("div"));return new Promise((e,t)=>{s.$once("completed",t=>e(t)),s.$once("cancel",e=>t(e))})}}},"7a36":function(e,t,s){},"7f2a":function(e,t,s){"use strict";s("531c")},8054:function(e,t,s){"use strict";s("a069")},"8e6b":function(e,t,s){"use strict";var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-dialog",{attrs:{title:e.$t("dialog.outlink-title"),visible:e.visible},on:{"update:visible":function(t){e.visible=t}}},[s("div",[s("el-input",{attrs:{type:"textarea",rows:20},model:{value:e.links,callback:function(t){e.links=t},expression:"links"}})],1),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{type:"primary"}},[e._v(e._s(e.$t("click-copy-link")))]),s("el-button",{on:{click:function(t){e.visible=!1}}},[e._v(e._s(e.$t("op.close")))])],1)])],1)},o=[],n=s("ebbf"),a={mixins:[n["b"]],props:{items:Array},data(){return{links:""}},methods:{loadLinks(){Promise.all(this.items.map(e=>this.$zpan.File.findLink(e.alias))).then(e=>{e.forEach(e=>{this.links+=e.link+"\r\n"})})}},mounted(){this.loadLinks()}},l=a,r=s("2877"),c=Object(r["a"])(l,i,o,!1,null,"1eff8eb1",null);t["a"]=c.exports},a069:function(e,t,s){},db7e:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticStyle:{height:"100%"}},[s("el-row",{staticClass:"toolbar"},[s("el-button",{attrs:{type:"primary",size:"medium",icon:"el-icon-upload"},on:{click:e.onUploadClick}},[e._v(e._s(e.$t("disk.upload")))]),s("el-button",{directives:[{name:"show",rawName:"v-show",value:e.folderBtnShown,expression:"folderBtnShown"}],attrs:{type:"primary",size:"medium",icon:"el-icon-folder-add",plain:""},on:{click:e.openCreateDiglog}},[e._v(e._s(e.$t("disk.folder")))]),s("el-button-group",{directives:[{name:"show",rawName:"v-show",value:e.selectedItems.length>0,expression:"selectedItems.length > 0"}],staticStyle:{"margin-left":"10px"}},[s("el-button",{attrs:{type:"primary",icon:"el-icon-download",size:"medium",plain:""},on:{click:e.onOutlinkClick}},[e._v(e._s(e.$t("disk.download")))]),s("el-button",{attrs:{type:"primary",icon:"el-icon-delete",size:"medium",plain:""},on:{click:e.deleteSelection}},[e._v(e._s(e.$t("disk.delete")))])],1),s("div",{staticStyle:{float:"right"}},[s("el-input",{staticClass:"search",attrs:{size:"small",placeholder:e.$t("topbar.search")},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.listRefresh.apply(null,arguments)}},model:{value:e.query.kw,callback:function(t){e.$set(e.query,"kw",t)},expression:"query.kw"}},[s("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"prefix"},slot:"prefix"})]),"list"==e.layout?s("i",{staticClass:"iconfont icon-grid",on:{click:function(t){e.layout="grid"}}}):s("i",{staticClass:"iconfont icon-list",on:{click:function(t){e.layout="list"}}})],1)],1),s("FileExplorer",{ref:"fexp",staticStyle:{height:"calc(100% - 67px)"},attrs:{layout:e.layout,dataLoader:e.dataLoader,linkLoader:e.linkLoader,rowButtons:e.rowButtons,moreButtons:e.moreButtons},on:{"selection-change":e.onSelectionChange}})],1)},o=[],n=s("6275"),a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-dialog",{attrs:{title:e.$t("dialog.moveto-title"),width:"30%",visible:e.visible},on:{"update:visible":function(t){e.visible=t}}},[s("el-tree",{attrs:{data:e.data,props:e.props,"node-key":"id","current-node-key":e.current.id,"default-expanded-keys":[0],load:e.loadNode,"highlight-current":!0,lazy:""},on:{"current-change":e.onCurrentChange},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.node;return s("span",{staticClass:"custom-tree-node"},[s("span",[s("i",{staticClass:"el-icon-folder"}),e._v("\n          "+e._s(i.label)+"\n        ")])])}}])}),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v(e._s(e.$t("op.confirm")))]),s("el-button",{on:{click:function(t){e.visible=!1}}},[e._v(e._s(e.$t("op.cancel")))])],1)],1)],1)},l=[],r=s("ebbf"),c={mixins:[r["a"],r["b"]],props:{alias:String,isDir:Boolean},data(){return{data:[],props:{label:"name",children:"folders",isLeaf:"leaf"},current:{},treectx:{}}},methods:{onCurrentChange(e,t){this.current=e},loadNode(e,t){0!==e.level?(this.treectx.node||1!==e.level||(this.treectx.node=e,this.treectx.resolve=t),this.$zpan.File.list({sid:this.getSid(),dir:e.data.fullpath}).then(e=>{let s=e.list.filter(e=>e.dirtype&&e.alias!=this.alias);t(s)})):t([{id:0,name:"/",parent:""}])},submit(){this.$zpan.File.move(this.alias,this.current.fullpath).then(e=>{this.$message({type:"success",message:this.$t("msg.move-success")}),this.finish(),this.close()})}}},h=c,d=(s("55ac"),s("2877")),u=Object(d["a"])(h,a,l,!1,null,"6144c87d",null),p=u.exports,m=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-dialog",{attrs:{title:e.$t("dialog.share-title"),width:e.shareForm.width,visible:e.visible},on:{"update:visible":function(t){e.visible=t}}},[s("el-form",{directives:[{name:"show",rawName:"v-show",value:!e.shareForm.done,expression:"!shareForm.done"}]},[s("el-form-item",{staticStyle:{"margin-left":"20px"},attrs:{label:e.$t("dialog.share-drawcode-switch")}},[s("el-switch",{model:{value:e.shareForm.private,callback:function(t){e.$set(e.shareForm,"private",t)},expression:"shareForm.private"}})],1),s("el-form-item",{staticStyle:{"margin-left":"20px"},attrs:{label:e.$t("dialog.share-expire-time")}},[s("el-select",{model:{value:e.shareForm.expire_sec,callback:function(t){e.$set(e.shareForm,"expire_sec",t)},expression:"shareForm.expire_sec"}},[s("el-option",{attrs:{label:"7 "+e.$t("day"),value:604800}}),s("el-option",{attrs:{label:"30 "+e.$t("day"),value:2592e3}}),s("el-option",{attrs:{label:"1 "+e.$t("year"),value:31536e3}}),s("el-option",{attrs:{label:"永久",value:31536e5}})],1)],1)],1),s("div",{directives:[{name:"show",rawName:"v-show",value:e.shareForm.done,expression:"shareForm.done"}],staticStyle:{"margin-left":"50px","line-height":"30px"}},[s("p",[e._v("\n        "+e._s(e.$t("dialog.share-link"))+"：\n        "),s("a",{attrs:{href:e.shareForm.link,target:"_blank"}},[e._v(e._s(e.shareForm.link))])]),e.shareForm.secret?s("p",[e._v(e._s(e.$t("dialog.share-drawcode"))+"："+e._s(e.shareForm.secret))]):e._e()]),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e.shareForm.done?s("div",[s("el-button",{staticClass:"copy-link",attrs:{type:"primary","data-clipboard-text":e.shareForm.link},on:{click:e.close}},[e._v(e._s(e.$t("click-copy-link")))]),s("el-button",{on:{click:e.close}},[e._v(e._s(e.$t("op.close")))])],1):s("div",[s("el-button",{on:{click:e.close}},[e._v(e._s(e.$t("op.cancel")))]),s("el-button",{attrs:{type:"primary"},on:{click:e.share}},[e._v(e._s(e.$t("op.confirm")))])],1)])],1)],1)},f=[],v={mixins:[r["b"]],props:{alias:String},data(){return{shareForm:{done:!1,width:"30%",private:!1,expire_sec:604800}}},methods:{share(e){this.$zpan.Share.create(this.shareForm).then(e=>{let t=window.location.origin,s=e.data.alias;this.shareForm.done=!0,this.shareForm.link=`${t}/s/${s}`,this.shareForm.secret=e.data.secret})}},mounted(){this.shareForm.matter=this.alias}},b=v,$=Object(d["a"])(b,m,f,!1,null,"3d33c360",null),g=$.exports,y=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-dialog",{attrs:{title:e.$t("dialog.upload-title"),visible:e.visible,"file-list":e.fileList,"close-on-click-modal":!1,"close-on-press-escape":!1,"before-close":e.closeConfirm,width:"400px"},on:{"update:visible":function(t){e.visible=t}}},[e._v("\n    "+e._s(e.destDir)+"\n    "),s("el-upload",{ref:"uploader",staticClass:"uploader",attrs:{action:"","http-request":e.handleUpload,limit:20,"on-progress":e.handleProgress,"on-success":e.handleProgress,"on-exceed":e.handleExceed,"on-remove":e.handleRemove,drag:"",multiple:""}},[s("i",{staticClass:"el-icon-upload"}),s("div",{staticClass:"el-upload__text"},[e._v("\n        "+e._s(e.$t("dialog.upload-tips"))+"\n        "),s("em",[e._v(e._s(e.$t("dialog.upload-click")))])])])],1)],1)},k=[],w={mixins:[r["b"]],props:{sid:Number,destDir:String},data(){return{fileList:[],uploading:!1}},methods:{closeConfirm(e){this.fileList.length>0&&this.uploading?this.$confirm("文件上传中，取消将终止上传，是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",customClass:"cancel-confirm"}).then(()=>{this.fileList.forEach(e=>{this.$refs.uploader.abort(e)}),e()}):e()},handleProgress(e,t,s){this.uploading="uploading"==t.status,this.fileList=s},handleExceed(e,t){this.$message.warning("每次最多允许 20 个文件同时上传，请分批操作！")},handleRemove(e,t){this.$refs.uploader.abort(e)},handleUpload(e){let t;const s=e=>{t=e};return e.filename=e.file.name,this.$zpan.File.upload(Number(this.sid),e,this.destDir,s).then(()=>{}),{abort:()=>{t("canceled by the user")}}}},beforeDestroy(){this.completed()}},_=w,x=(s("8054"),Object(d["a"])(_,y,k,!1,null,null,null)),C=x.exports,F=s("8e6b"),S={mixins:[r["a"]],data(){return{query:{kw:"",dir:""},layout:"list",folderBtnShown:!1,moreButtons:[{name:"move",title:this.$t("ftb.move"),action:this.move},{name:"rename",title:this.$t("ftb.rename"),action:this.rename},{name:"remove",title:this.$t("ftb.remove"),action:this.remove}],selectedItems:[]}},watch:{$route(e,t){this.query.type=e.query.type,this.folderBtnShown=!this.query.type}},computed:{rowButtons(){return 1==this.cs.mode?[{name:"download",icon:"el-icon-download",action:this.openDownload,shown:e=>!e.dirtype},{name:"share",icon:"el-icon-share",action:this.share}]:[{name:"download",icon:"el-icon-download",action:this.openDownload,shown:e=>!e.dirtype},{name:"viewlink",icon:"el-icon-view",action:this.viewlink}]}},methods:{dataLoader(e,t,s){return e!=this.query.dir&&(this.query.dir=e),this.query.sid=this.getSid(),this.query.offset=t||0,this.query.limit=s||10,new Promise((e,t)=>{this.$zpan.File.list(this.query).then(t=>{this.query.kw="",e(t)})})},linkLoader(e){return new Promise((t,s)=>{this.$zpan.File.findLink(e.alias).then(e=>{t(e.link)}).catch(s)})},listRefresh(){this.$refs.fexp.listRefresh()},openDownload(e){this.linkLoader(e).then(t=>{let s=document.createElement("a");s.setAttribute("href",t),s.setAttribute("download",e.name),s.click(),s.remove()})},openCreateDiglog(){this.$prompt(this.$t("tips.create-folder"),this.$t("create-folder"),{confirmButtonText:this.$t("op.confirm"),cancelButtonText:this.$t("op.cancel")}).then(({value:e})=>{let t={sid:this.getSid(),name:e,dir:this.query.dir,is_dir:!0};this.$zpan.File.create(t).then(e=>{this.$message({type:"success",message:this.$t("msg.create-success")}),this.listRefresh()})})},onUploadClick(){Object(n["a"])(C)({sid:this.getSid(),destDir:this.query.dir}).then(()=>{this.listRefresh()})},onOutlinkClick(){Object(n["a"])(F["a"])({items:this.selectedItems})},share(e){Object(n["a"])(g)({alias:e.alias})},viewlink(e){this.linkLoader(e).then(e=>{const t=this.$createElement;this.$msgbox({title:"获取外链",message:t("p",null,e),confirmButtonText:"确定"})})},move(e){Object(n["a"])(p)({alias:e.alias,isDir:e.dirtype>0}).then(()=>{this.listRefresh()})},rename(e){this.$prompt(this.$t("tips.rename"),this.$t("op.rename"),{inputValue:e.name,confirmButtonText:this.$t("op.confirm"),cancelButtonText:this.$t("op.cancel")}).then(({value:t})=>{this.$zpan.File.rename(e.alias,t).then(e=>{this.$message({type:"success",message:this.$t("msg.rename-success")}),this.listRefresh()})})},remove(e){this.$confirm(this.$t("tips.remove"),this.$t("op.delete")+" "+e.name,{type:"warning",confirmButtonText:this.$t("op.confirm"),cancelButtonText:this.$t("op.cancel")}).then(()=>{this.$zpan.File.delete(e.alias).then(e=>{this.$message({type:"success",message:this.$t("msg.delete-success")}),this.listRefresh()})})},onSelectionChange(e){this.selectedItems=e},deleteSelection(){this.$confirm(this.$t("tips.batch-delete"),this.$t("op.batch-delete"),{type:"warning",confirmButtonText:this.$t("op.confirm"),cancelButtonText:this.$t("op.cancel")}).then(()=>{const e=this.$loading({lock:!0,text:this.$t("tips.deleting"),spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});Promise.all(this.selectedItems.map(e=>this.$zpan.File.delete(e.alias))).then(t=>{this.listRefresh(),e.close(),this.$message({type:"success",message:this.$t("msg.batch-delete-success")})}).catch(t=>{e.close(),console.log(t)})})}},mounted(){this.query.type=this.$route.query.type,this.folderBtnShown=!this.query.type}},B=S,q=(s("7f2a"),Object(d["a"])(B,i,o,!1,null,"fe79e714",null));t["default"]=q.exports},ebbf:function(e,t,s){"use strict";s.d(t,"a",(function(){return o})),s.d(t,"b",(function(){return a}));const i={data(){return{cs:{}}},watch:{$route(e,t){this.setCs()}},computed:{},methods:{setCs(){this.$store.state.storages.forEach(e=>{e.name==this.$route.params.sname&&(this.cs=e)})},getSid(){return this.cs.id}},mounted(){this.setCs()}};var o=i;const n={data(){return{visible:!1}},watch:{visible(e){!e&&this.$destroy()}},mounted(){document.body.appendChild(this.$el),this.visible=!0},destroyed(){this.$el.parentNode.removeChild(this.$el)},methods:{open(){this.visible=!0},close(){this.visible=!1},completed(){this.$emit("completed")},finish(){this.close(),this.completed()}}};var a=n}}]);